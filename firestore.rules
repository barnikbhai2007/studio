rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Global rule: Allow any authenticated user to read and write everything.
    // This ensures that once a user is registered/logged in, they have full access.
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }

    // Public Read Access: These collections MUST be publicly readable (even without auth)
    // so that the landing page stats and result history can load correctly.
    
    match /userProfiles/{userId} {
      allow read: if true;
      // Write is handled by the global rule above (must be signed in)
    }

    match /gameRooms/{gameRoomId} {
      allow read: if true;
      
      // Allow sub-collections (rounds, emotes) to be publicly readable as well
      match /{allSubdocs=**} {
        allow read: if true;
      }
    }

    match /footballers/{footballerId} {
      allow read: if true;
    }
    
    match /battleHistories/{bhId} {
      allow read: if true;
    }
  }
}