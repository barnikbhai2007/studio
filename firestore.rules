rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // --- Global Helper Functions ---

    // Checks if the user is authenticated.
    function isSignedIn() {
      return request.auth != null;
    }

    // --- Collection Rules ---

    // Global rule: Allow any authenticated user to read and write everything.
    // This ensures that once a user is signed in, they have full access to play and view results.
    match /{allPaths=**} {
      allow read, write: if isSignedIn();
    }

    // Public Read Access: These collections must be publicly readable (even without auth)
    // so that the landing page stats and game setup can load correctly.
    
    match /userProfiles/{userId} {
      allow read: if true;
      // Write access is handled by the global rule (must be signed in)
    }

    match /gameRooms/{gameRoomId} {
      allow read: if true;
      
      // Allow sub-collections (rounds, emotes) to be publicly readable as well
      match /{allSubdocs=**} {
        allow read: if true;
      }
    }

    match /footballers/{footballerId} {
      allow read: if true;
    }
    
    match /battleHistories/{bhId} {
      allow read: if true;
    }
  }
}